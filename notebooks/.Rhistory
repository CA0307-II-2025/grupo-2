}
return(list(lambda_L = lambda_L, lambda_U = lambda_U))
}
res_prov_sec_tail <- res_prov_sec %>%
rowwise() %>%
mutate(
tail = list(
tail_dep(
family = copula_familia(copula),
par    = par,
par2   = ifelse("par2" %in% names(.), par2, NA)
)
)
) %>%
unnest_wider(tail)
res_prov_sec_tail <- res_prov_sec %>%
rowwise() %>%
mutate(
tail = list(
tail_dep(
family = copula_familia(copula),
par    = par,
par2   = ifelse("par2" %in% names(.), par2, NA)
)
)
) %>%
unnest_wider(tail)
res_prov_cat_tail <- res_prov_cat %>%
rowwise() %>%
mutate(
tail = list(
tail_dep(
family = copula_familia(copula),
par    = par,
par2   = ifelse("par2" %in% names(.), par2, NA)
)
)
) %>%
unnest_wider(tail)
res_sec_cat_tail <- res_sec_cat %>%
rowwise() %>%
mutate(
tail = list(
tail_dep(
family = copula_familia(copula),
par    = par,
par2   = ifelse("par2" %in% names(.), par2, NA)
)
)
) %>%
unnest_wider(tail)
plot_heatmap_tail <- function(df, cola = c("inferior","superior"),
titulo = "Dependencia de cola"){
cola <- match.arg(cola)
col_sel <- ifelse(cola == "inferior", "lambda_L", "lambda_U")
df_wide <- df %>%
select(varA, varB, !!sym(col_sel)) %>%
pivot_wider(
names_from = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
pivot_longer(cols = -varA, names_to = "varB", values_to = "lambda")
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
scale_fill_gradient2(
low = "lightblue", mid = "white", high = "darkred",
midpoint = 0, na.value = "grey90"
) +
labs(
title = titulo,
x = "Variable B",
y = "Variable A",
fill = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
plot_heatmap_tail(res_prov_sec_tail, cola = "inferior",
titulo = "Dependencia de cola inferior (λ_L)")
res_prov_cat_tail
res_prov_cat_riesgo
colnames(res_prov_cat_riesgo)
plot_heatmap_tail(res_prov_sec_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail <- function(df, cola = c("inferior","superior"),
titulo = "Dependencia de cola"){
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
cola <- match.arg(cola)
col_sel <- ifelse(cola == "inferior", "lambda_L", "lambda_U")
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(col_sel)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "lambda"
)
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
# Paleta de amarillos
scale_fill_gradient(
low      = "#FFF9C4",   # amarillo muy claro
high     = "#FBC02D",   # amarillo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(lambda, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_tail(res_prov_sec_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_prov_cat_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_prov_sec_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_prov_cat_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_sec_cat_tail, cola = "superior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_prov_sec_tail, cola = "superior",
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_prov_cat_tail, cola = "superior",
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_sec_cat_tail, cola = "superior",
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_prov_sec_tail, cola = "inferior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_prov_cat_tail, cola = "inferior",
titulo = "Dependencia de cola inferior (λ_L)")
plot_heatmap_tail(res_sec_cat_tail, cola = "inferior",
titulo = "Dependencia de cola inferior (λ_L)")
res_prov_sec_tail
plot_heatmap_tail <- function(df,
titulo = "Dependencia de cola"){
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
cola <- match.arg(cola)
col_sel <- 'Lambda_L'
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(col_sel)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "lambda"
)
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
# Paleta de amarillos
scale_fill_gradient(
low      = "#FFF9C4",   # amarillo muy claro
high     = "#FBC02D",   # amarillo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(lambda, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail <- function(df,
titulo = "Dependencia de cola"){
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
col_sel <- 'Lambda_L'
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(col_sel)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "lambda"
)
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
# Paleta de amarillos
scale_fill_gradient(
low      = "#FFF9C4",   # amarillo muy claro
high     = "#FBC02D",   # amarillo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(lambda, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail <- function(df,
titulo = "Dependencia de cola"){
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
col_sel <- 'lambda_L'
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(col_sel)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "lambda"
)
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
# Paleta de amarillos
scale_fill_gradient(
low      = "#FFF9C4",   # amarillo muy claro
high     = "#FBC02D",   # amarillo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(lambda, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail <- function(df,
titulo = "Dependencia de cola"){
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
cola <- 'inferior'
col_sel <- 'lambda_L'
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(col_sel)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(col_sel)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "lambda"
)
ggplot(df_long, aes(x = varB, y = varA, fill = lambda)) +
geom_tile(color = "white") +
# Paleta de amarillos
scale_fill_gradient(
low      = "#FFF9C4",   # amarillo muy claro
high     = "#FBC02D",   # amarillo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(lambda, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = paste0("λ_", ifelse(cola=="inferior","L","U"))
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_prov_sec_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_prov_cat_tail,
titulo = "Dependencia de cola superior (λ_U)")
plot_heatmap_tail(res_sec_cat_tail,
titulo = "Dependencia de cola superior (λ_U)")
library(dplyr)
library(tidyr)
library(ggplot2)
plot_heatmap_metric <- function(df, metric, titulo = NULL) {
if (is.null(titulo)) {
titulo <- paste("Heatmap de", metric)
}
df_wide <- df %>%
select(varA, varB, !!sym(metric)) %>%
pivot_wider(
names_from = varB,
values_from = !!sym(metric)
)
df_long <- df_wide %>%
pivot_longer(cols = -varA, names_to = "varB", values_to = "value")
ggplot(df_long, aes(x = varB, y = varA, fill = value)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "lightyellow", high = "red") +
labs(
title = titulo,
x = "Variable B",
y = "Variable A",
fill = metric
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid = element_blank()
)
}
plot_heatmap_metric(res_prov_sec_riesgo, "VaR_Cop_95",
"VaR conjunto 95% – Provincias vs Sectores")
library(dplyr)
library(tidyr)
library(ggplot2)
library(rlang)
plot_heatmap_metric <- function(df, metric, titulo = NULL) {
if (is.null(titulo)) {
titulo <- paste("Heatmap de", metric)
}
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(metric)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(metric)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "value"
)
ggplot(df_long, aes(x = varB, y = varA, fill = value)) +
geom_tile(color = "white") +
# Paleta secuencial de rojos
scale_fill_gradient(
low      = "#FFEBEE",   # rojo muy claro
high     = "#C62828",   # rojo intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(value, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = metric
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_metric(res_prov_sec_riesgo, "VaR_Cop_95",
"VaR conjunto 95% – Provincias vs Sectores")
plot_heatmap_metric(res_prov_sec_riesgo, "VaR_Cop_95",
"VaR conjunto 95%")
plot_heatmap_metric(res_prov_sec_riesgo, "VaR_Cop_95",
"VaR conjunto 95%")
plot_heatmap_metric(res_prov_cat_riesgo, "VaR_Cop_95",
"VaR conjunto 95%")
plot_heatmap_metric(res_sec_cat_riesgo, "VaR_Cop_95",
"VaR conjunto 95%")
plot_heatmap_metric(res_prov_sec_riesgo, "VaR_Cop_99",
"VaR conjunto 99%")
plot_heatmap_metric(res_prov_cat_riesgo, "VaR_Cop_99",
"VaR conjunto 99%")
plot_heatmap_metric(res_sec_cat_riesgo, "VaR_Cop_99",
"VaR conjunto 99%")
plot_heatmap_metric(res_prov_sec_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_prov_cat_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_sec_cat_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_prov_sec_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
plot_heatmap_metric(res_prov_cat_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
plot_heatmap_metric(res_sec_cat_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
plot_heatmap_metric <- function(df, metric, titulo = NULL) {
if (is.null(titulo)) {
titulo <- paste("Heatmap de", metric)
}
df_wide <- df %>%
dplyr::select(varA, varB, !!sym(metric)) %>%
tidyr::pivot_wider(
names_from  = varB,
values_from = !!sym(metric)
)
df_long <- df_wide %>%
tidyr::pivot_longer(
cols      = -varA,
names_to  = "varB",
values_to = "value"
)
ggplot(df_long, aes(x = varB, y = varA, fill = value)) +
geom_tile(color = "white") +
# Paleta secuencial de rojos
scale_fill_gradient(
low      = "#FFF3E0",   # naranja muy claro
high     = "#EF6C00",   # naranja intenso
na.value = "grey90"
) +
# Número sobre la casilla
geom_text(aes(label = round(value, 2)),
color = "black",
size  = 3.5,
na.rm = TRUE) +
labs(
title = titulo,
x     = "Variable B",
y     = "Variable A",
fill  = metric
) +
theme_minimal(base_size = 13) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.grid  = element_blank(),
plot.title  = element_text(face = "bold", hjust = 0.5)
)
}
plot_heatmap_metric(res_prov_sec_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_prov_cat_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_sec_cat_riesgo, "CVaR_Cop_95",
"CVaR conjunto 95%")
plot_heatmap_metric(res_prov_sec_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
plot_heatmap_metric(res_prov_cat_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
plot_heatmap_metric(res_sec_cat_riesgo, "CVaR_Cop_99",
"CVaR conjunto 99%")
